%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Please note that whilst this template provides a 
% preview of the typeset manuscript for submission, it 
% will not necessarily be the final publication layout.
%
% letterpaper/a4paper: US/UK paper size toggle
% num-refs/alpha-refs: numeric/author-year citation and bibliography toggle


%\documentclass[letterpaper]{oup-contemporary}
\documentclass[a4paper,num-refs]{oup-contemporary}



%%% Journal toggle; only specific options recognised.
%%% (Only "gigascience" and "general" are implemented now. Support for other journals is planned.)%
%\journal{Test}
\jname{Università degli studi Roma Tor Vergata}
\jlogo{}

\usepackage{graphicx}
\usepackage{siunitx}
\usepackage{import}
\usepackage{amsmath}
%\numberwithin{equation}{section}% numera eq come #section.#formula
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{amssymb}
\usepackage{wasysym}
\usepackage{cancel}
\usepackage{textcomp}
\usepackage{cleveref}
\crefformat{section}{\S#2#1#3} % see manual of cleveref, section 8.2.1
\crefformat{subsection}{\S#2#1#3}
\crefformat{subsubsection}{\S#2#1#3}
\usepackage{lipsum}  
\usepackage{listings}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codestring}{rgb}{0.4,0.4,0.4}
\definecolor{backcolour}{rgb}{0.96,0.96,0.96}
\definecolor{bbcolour}{rgb}{0.01,0.03,0.35}
\definecolor{indexcolour}{rgb}{0,0.4,0.4}
\lstdefinestyle{mystyle}{
	backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegreen},
	classoffset=1,
	keywordstyle=\color{bbcolour},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codestring},
	basicstyle=\ttfamily\small,
	breakatwhitespace=false,  
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=false,                 
	numbers=left,                    
	numbersep=3pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2
}
\lstset{texcl=false, mathescape=true,style=mystyle}
\lstset{emph={%  
		i, j%
	},emphstyle={\color{indexcolour}}%
}%

\usepackage[euler]{textgreek}


\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[italian, english]{babel}
\graphicspath{{figures/}} %Setting the graphicspat%h
\graphicspath{{figures/}} %Setting the graphicspath
\makeatletter
\providecommand*{\input@path}{}
\edef\input@path{{figures/}{}\input@path}% prepend
\makeatother


%%% Flushend: You can add this package to automatically balance the final page, but if things go awry (e.g. section contents appearing out-of-order or entire blocks or paragraphs are coloured), remove it!
% \usepackage{flushend}

\title{Omogeneizzazione numerica di materiali microstrutturati}

%%% Use the \authfn to add symbols for additional footnotes, if any. 1 is reserved for correspondence emails; then continuing with 2 etc for contributions.
\author{Mastrofini Alessandro}

%\affil[1]{First Institution}
%\affil[2]{Second Institution}

%%% Author Notes
\authnote{alessandro.mastrofini@alumni.uniroma2.eu}
%\authnote{\authfn{2}Contributed equally.}

%%% Paper category
\papercat{Meccanica Computazionale dei Tessuti e Biomateriali}

%%% "Short" author for running page header
\runningauthor{}

%%% Should only be set by an editor%
%\jvolume{00}
\jnumber{1}
\jyear{2021}

\begin{document}

\begin{frontmatter}
\maketitle
\begin{abstract}
The Abstract (250 words maximum) should be structured to include the following details:

 \textbf{Background}, the context and purpose of the study;
 
  \textbf{Results}, the main findings;
  
   \textbf{Conclusions}, brief summary and potential implications. 
   
   Please minimize the use of abbreviations and do not cite references in the abstract.
\end{abstract}

\begin{keywords}
trabecular bone; homogenization; composite material
\end{keywords}
\end{frontmatter}



\section{Introduzione}

Lo scopo della seguente analisi è quello di indagare l'influenza delle proprietà microstrutturali sul comportamento macroscopico di un materiale composito.




\begin{figure*}%[b!]  %% Add a [b!] if you prefer the wide image to be at the bottm of the page
	\centering
	\def\svgwidth{\textwidth}
	\input{homogen.pdf_tex}
	\caption{Idealizzazione del RVE. (a) Ricostruzione tridimensionale; (b) Slice di riferimento no. 650; (c) ingrandimento del volume di interesse; (d) idealizzazione geometrica} 
	
\label{fig:homogen_RVE}
\end{figure*}


\section{Struttura multiscala}


DESCRIVI OSSO TRABECOLARE DA COWIN e LIBRO ISTOLOGIA

\textcolor{blue}{\lipsum[1-8]}

\section{Omogenizzazione}

L'obiettivo è quindi quello di ottenere delle proprietà materiali alla macroscala a partire dalle proprietà alla microscala come le rigidezza dei due materiali, matrice ossea e pori.

\subsection{Volume di interesse}
\label{sec:RVE}

Il primo passo, per poter procedere ad un'omogenizzazione, è quello di definire un volume rappresentativo (RVE) tale da essere rappresentativo dal punto di vista statistico della distribuzione geometrica dei costituenti, quindi della microscala. Per farlo il codice calcola automaticamente il lato nel range di qualche mm a partire da alcune considerazioni. Viene rispettato il diametro medio dei pori \citep{Doktor:2011} e la frazione volumetrica  \citep{Cowin1}. 

Sulla base di queste considerazioni vengono inseriti 25 pori equidistanti e tali che la loro distanza dal bordo sia la metà della distanza tra ogni poro. Questo consente di avere un RVE simmetrico e rappresentativo di una selezione delle trabecole. 

Maggiori informazioni sulla procedura di automazione del calcolo del RVE sono nella sezione \ref{sec:RVE_code}.

Inoltre, per fare le opportune considerazioni nel considerare le tensioni medie, i pori vengono considerati pieni di un materiale a bassa rigidezza rappresentativo del midollo osseo. 

APPROFNDISIC QUESTA PARTE

INSERISCI DISCUSSIONE TECNICA SULLA DISTRIBUXIONE DI PORI 


\subsection{Stime analitiche}

Per confrontare i dati dell'omogenizzazione vengono considerate le stime analitiche di Voigt e Reuss. 

L'approssimazione di Voigt considera la matrice di rigidezza come una media pesata per le volume fraction delle rigidezze dei costituenti. 
\begin{equation}
	\mathbb C_{\operatorname{Voigt}}=(1-v_f)\mathbb C_b+v_f \mathbb C_m
\end{equation}

Le stime di Reuss sono analoghe ma in cedevolezza:

\begin{equation}
	\mathbb S_{\operatorname{Voigt}}=(1-v_f)\mathbb S_b+v_f \mathbb S_m
\end{equation}

Vengono considerate queste due stime per via del teorema di Hill che garantisce, sotto le opportune ipotesi, che la matrice di rigidezza sia compresa tra queste \citep{ABOUDI201387}. Reuss costituisce il limite inferiore e Voigt il limite superiore dell'omogenizzazione. 

I due materiali vengono con considerati singolarmente isotropi, quindi tali da avere un comportamento materiale descritto dalla matrice di cedevolezza  \eqref{eq:isotropic_S}.

\begin{equation}
[\mathbb S]_{\operatorname{iso}}=\left[\begin{array}{cccccc}
	\frac{1}{E} & -\frac{\nu}{E} & -\frac{\nu}{E} & 0 & 0 & 0 \\
	-\frac{\nu}{E} & \frac{1}{E} & -\frac{\nu}{E} & 0 & 0 & 0 \\
	-\frac{\nu}{E} & -\frac{\nu}{E} & \frac{1}{E} & 0 & 0 & 0 \\
	0 & 0 & 0 & \frac{2(1+\nu)}{E} & 0 & 0 \\
	0 & 0 & 0 & 0 & \frac{2(1+\nu)}{E} & 0 \\
	0 & 0 & 0 & 0 & 0 & \frac{2(1+\nu)}{E}
\end{array}\right]
\label{eq:isotropic_S}
\end{equation}

In particolare queste matrici vengono calcolate e per ogni iterazione del processo di omogenizzazione viene verificato che il risultato sia compreso in tali stime tramite la funzione \texttt{VoigtReussTest[]}.


\subsection{Omogenizzazione numerica}
\label{sec:homogen}

Viene quindi strutturata una campagna di simulazioni tale da analizzare il RVE ed estrarre una matrice di rigidezza omogenizzata. Ulteriori considerazioni vengono fatte sul parametro $\mathbb C_{11}^{(om)}$.

L'approccio all'omogenizzazione segue condizioni al bordo omogenee di tipo spostamento.  
In particolare, applicheremo un campo di spostamento alla macroscala supponendo che sia rappresentativo di quello alla microscala. Quindi otterremo un certo campo di tensione alla microscala, funzione del punto. Possiamo quindi considerare il campo di tensione alla macroscala come la media di quello alla microscala. In particolare, queste condizioni sono garantite dall'Average Strain Theorem. Quindi applicando un campo di deformazione alla macroscala otterrei le deformazioni alla microscala e potrei estrarre le tensioni semplicemente risolvendo il problema dell'equilibrio elastico:
\begin{equation}
\underline{\sigma}=\langle\tilde{\sigma}\rangle=\mathbb C\langle\tilde{\varepsilon}\rangle=\mathbb C \underline{\varepsilon}
\end{equation}
In particolare, applicando condizioni di deformazione unitaria su $\varepsilon_1$,$\varepsilon_2$ e $\gamma_{12}$ otterrei rispettivamente prima, seconda e terza colonna di $\mathbb C$.

Questo viene implementato tramite una campagna di simulazioni in \texttt{Mathematica} sfruttando il tool \texttt{AceFEM}. 

Viene sfruttata la procedura \texttt{TEST[]} che permette di applicare in sequenza le tre condizioni di spostamento e ottenere così la matrice di rigidezza:

\begin{equation}
\mathbb C^{(om)}=\left(
\begin{array}{ccc}
	756.78 & 80.90 & 0.00 \\
	80.90 & 756.78 & 0.00 \\
	0.00 & 0.00 & 40.87\\
\end{array}
\right)
\end{equation}.

Da questa matrice COMPLETA COMPLETA


\begin{table}[bt!]
	\caption{Parametri materiali}\label{tab:example}
	\begin{tabular}{l r l}
		\toprule
		Nome & Valore &  Reference\\
		\midrule
		$E_b$ & $3.8$ GPa & \citet{Cowin1}  \\
		$\nu_b$  & $0.3$ & \citet{Dalstra:93,Wirtz:2000}  \\
		$E_m$  & $15$ KPa  & \citet{Jansen:2015} \\ 
		$\nu_m$ & $0.1 $&    \\
		
		$C_{11}^{(b)}$&$6730.77 $MPa& \cref{sec:homogen} \textsuperscript{*}\\
		$C_{11}^{(m)}$& $0.15$ Mpa& \cref{sec:homogen} \textsuperscript{*}\\
		$C_{11}^{(om)}$& $756.78 $ Mpa & \cref{sec:homogen} \textsuperscript{*}\\
		$L$ & $1.324$ mm& \cref{sec:RVE} \textsuperscript{*}\\
		\bottomrule
	\end{tabular}
	\begin{tablenotes}
		
		\item \textsuperscript{*}Parametri calcolati
	\end{tablenotes}
\end{table}


\section{Variazione della microstruttura}

\section{Effetto del carico sulla struttura macroscopica}

\textcolor{blue}{\lipsum[1-8]}

\section{Conclusioni}

\section{???}


\section{Metodi}

\subsection{Elaborazione dell'immagine}

L'immagine presentata in figura \ref{fig:homogen_RVE}(a) è una ricostruzione 3D ottenuta con un algoritmo scritto ad hoc \citep{Mastrofini:21} a partire dalle singole slices (500-650) \citep{ESA:2005}. A seguire è stata selezionata la slice no. 650 che risulta essere quella a contrasto maggiore e soddisfa la frazione di pori \citep{CC21}. In particolare si può utilizzare il tool 
\texttt{Image Region Analyzer} in Matlab per averne conferma. Queste considerazioni, e soprattutto il volume 3D, hanno permesso di arrivare all'idealizzazione del volume di interesse presentata in  \cref{sec:RVE}

\subsection{Rappresentazione del volume di riferimento}
\label{sec:RVE_code}

Per la creazione dei fori viene considerata una griglia quadrata con $\sqrt{\text{N. fori}}$ per lato e viene generato un rettangolo esterno tale da garantire la volume fraction desiderata. Quindi viene generato anche un vettore contenente tutte le posizioni dei centri calcolate. Il calco viene effettuato con le funzioni \texttt{GeometryInitailization[]} e \texttt{GeometrySet[]}.

Vengono quindi creati e fori e assegnati i marker come identificato nello snippet \ref{code_rve}.  Un esempio di questo RVE in Figura \ref{fig:Mesh}.

Un calcolo più raffinato può essere fatto considerando la distribuzione del diametro dei pori \citep{Doktor:2011} e quindi creare i fori di diametro diverso rispettando la distribuzione. Chiaramente questo richiede un RVE con più inclusioni in modo da essere più rappresentativo. 

Per quanto riguarda la discretizzazione viene preso il valore ottimo tale da garantire un risultato sufficientemente accurato in tempi ridotti. Vedi \cref{sec:convergenza}.

Per la discretizzazione sono stati usati elementi T1LE, triangolari a 3 nodi con funzioni di forma lineari e una mappa isoparametrica.  

\begin{lstlisting}[language=Mathematica,caption=Generazione RVE,label=code_rve]
$\Omega$ext=Rectangle[{0,0},{Lx,Ly}];
$\Omega$=$\Omega$ext;
Do[$\Omega$=RegionDifference[
	$\Omega$,Disk[{centerx$\llbracket$i$\rrbracket$,centery$\llbracket$j$\rrbracket$},{Rc,Rc}]],
	{i,1,Ninclx},{j,1,Nincly}]
marker={{{Lx/100,Ly/100},1}};
Do[marker=Join[
	marker,{{{centerx$\llbracket$i$\rrbracket$,centery$\llbracket$j$\rrbracket$},2}}],
	{i,1,Ninclx},{j,1,Nincly}]
mesh=ToElementMesh[
$\Omega$,"RegionHoles"->None,"RegionMarker"->marker];	

\end{lstlisting}


\begin{figure}[bt!] %% preferably at bottom or top of column
	\centering
	\includegraphics[width=\linewidth]{test_mesh_8.png}
	\caption{Mesh del volume rappresentativo con 756.787 DoF}\label{fig:Mesh}
\end{figure}



\subsection{Codice}

\subsubsection{Condizioni al bordo}

DESCriVI CODICE BORDO

\subsection{Analisi di convergenza}
\label{sec:convergenza}

Per effettuare l'analisi a convergenza è stata implementata una routine che ripete diverse volte l'omogenizzazione citata in \cref{sec:homogen} andando ad infittire la mesh. I risultati sono presenti in Tabella \ref{tab:convergence} e in \cref{fig:convergence}.

Analizzando i risultati è stato preso come valore ottimo quello ottenuto nell'iterazione 8 che presenta un errore rispetto il risultato ideale dello $0.11\%$ a fronte di differenza di impegno computazionale del $83\%$. 



\begin{figure}[bt!] %% preferably at bottom or top of column
	\centering
	\includegraphics[width=\linewidth]{test_data.pdf}
	\caption{Analisi di convergenza sul parametro $\mathbb C_{11}$}\label{fig:convergence}
\end{figure}

\begin{table}[bt!]
	\caption{Analisi di convergenza}\label{tab:convergence}
	\begin{tabular}{l r r l}
		\toprule
Iterazione&	$C_{11}^{(om)}$ & DoF &  Time (s)\\
		\midrule
	1&		$845.289$ &$3368 $ &  $4.8125 $\\
			2&	$846.427$ & $3384$ &  $4.7500 $\\
			3&	$ 772.214$ &$ 16874$  &  $ 8.5625$\\
			4&$ 763.611$ &$ 39022$  &$ 14.0625$   \\
			5&$ 759.333$ &$ 253262$  & $ 60.7656$     \\
		6&	$ 759.333$ & $ 253316$ & $ 59.2188$     \\
		7&	$758.829 $ &$ 263104$  & $ 61.6563$     \\
		8&	$ 756.787$ &$ 453436$  & $95.2344 $     \\
		9&	$ 755.942$ &$2800338 $  &  $509.141 0$    \\
		10&	$755.903 $ &$ 3024312$  &  $ 555.0630$    \\
		\bottomrule
	\end{tabular}
\end{table}



\section{Disponibilità del codice e materiale aggiuntivo}




\subsection{Lista delle abbreviazioni}

\begin{itemize}
	\item RVE , rappresentative volume element 
	\item $\mathbb C^{(om)}$:,matrice di rigidezza ottenuta dall'omogenizzazione
	\item $\cdot_b$, parametri che fanno riferimento all'osso
	\item $\cdot_m$, parametri che fanno riferimento al midollo
	\item DoF, degrees of freedom
\end{itemize}
 







%% Specify your .bib file name here, without the extension
\bibliography{paper-refs}




\end{document}
